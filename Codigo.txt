from kafka import KafkaProducer
import json
import time

SERVER = 'guilherme.venturini-broker'
PORT = '29092'
TOPIC = 's7projeto'
SERVER_INFO = SERVER + ':' + PORT

producer = KafkaProducer(bootstrap_servers=[SERVER_INFO],
                         value_serializer=lambda x: json.dumps(x).encode('utf-8'))

FILE = 'covid.csv'

with open(FILE) as file_in:
    for msg in file_in:
        print(f"Sending COVID Data: {msg.strip()}")
        producer.send(TOPIC, value=msg.strip().encode('utf-8'), partition=0)
        time.sleep(1)




from kafka import KafkaProducer
from faker import Faker
import json
import time

fake = Faker()

# Função para criar dados (fake)
def get_customer():
    return {
        'nome': fake.name(),
        'profissao': fake.job(),
        'endereco': fake.address(),
        'nascimento': fake.year()
    }

SERVER = 'guilherme.venturini-broker'
PORT = '29092'
TOPIC = 's7projeto'
SERVER_INFO = SERVER + ':' + PORT

producer = KafkaProducer(bootstrap_servers=[SERVER_INFO],
                         value_serializer=lambda x: json.dumps(x).encode('utf-8'))

while True:
    msg = get_customer()
    print(f"Sending Fake Data: {msg}")
    producer.send(TOPIC, value=json.dumps(msg).encode('utf-8'), partition=1)
    time.sleep(1)






from kafka import KafkaConsumer, TopicPartition
from json import loads

SERVER = 'guilherme.venturini-broker'
PORT = '29092'
TOPIC = 's7projeto'
SERVER_INFO = SERVER + ':' + PORT

consumer = KafkaConsumer(bootstrap_servers=[SERVER_INFO],
                         value_deserializer=lambda x: loads(x.decode('utf-8')),
                         auto_offset_reset='earliest',
                         enable_auto_commit=True,
                         group_id='my-group')

# Assignando as partições específicas ao consumidor
partitions = [TopicPartition(TOPIC, 0), TopicPartition(TOPIC, 1)]
consumer.assign(partitions)

for message in consumer:
    partition = message.partition
    value = message.value
    if partition == 0:
        print(f"COVID Data: {value}")
    elif partition == 1:
        print(f"Fake Data: {value}")
